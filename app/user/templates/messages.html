{% extends "base.html" %}

{% block navbar %}
    {% include "navbar.html" %}
{% endblock %}

{% block title %} Mensajes {% endblock %}

{% block content %}

    <br>

    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link {% if view_message == 0 %} active {% endif %}" aria-current="page" href="{{ url_for('user.show_messages_received') }}"><i class="bi bi-inbox"></i> Recibidos</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if view_message == 1 %} active {% endif %}" href="{{ url_for('user.show_messages_sent') }}"><i class="bi bi-send"></i> Enviados</a>
        </li>
    </ul>

    <div class="list-group">
        {% for message in messages %}
            <a href="{{ url_for('user.view_message', id=message.id) }}" class="list-group-item list-group-item-action" aria-current="true">
            <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">
                    {% if view_message == 0 %} {{ message.author.username }} {% else %} {{ message.recipient.username }} {% endif %}
                    {% if not message.read and view_message == 0 %}
                        <span class="badge bg-secondary">Nuevo</span>
                    {% endif %}
                </h5>
                <small>{{ moment(message.created_at).fromNow() }}</small>
            </div>
            <!-- <p class="mb-1">{{ message.message }}</p> -->
            </a>
        {% endfor %}
    </div>

    {% if pagination.pages > 1 %}
        <nav aria-label="Messages list">
            <ul class="pagination justify-content-center">
                <li class="page-item {% if not pagination.has_prev %} disabled {% endif %}">
                    <a class="page-link" href="{{ url_for('user.messages', page=pagination.prev_num) }}" aria-label="Previous">Anterior</a>
                </li>
                {% for page in pagination.iter_pages() %}
                    {% if page %}
                        <li class="page-item {% if pagination.page == page %} active {% endif %}">
                            <a class="page-link" href="{{ url_for('user.messages', page=page) }}">{{ page }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                {% endfor %}
                <li class="page-item {% if not pagination.has_next %} disabled {% endif %}">
                    <a class="page-link" href="{{ url_for('user.messages', page=pagination.next_num) }}" aria-label="Next">Siguiente</a>
                </li>
            </ul>
        </nav>
    {% endif %}

{% endblock %}
